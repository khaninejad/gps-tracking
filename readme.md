
# GPS Tracking Package
![CI](https://github.com/khaninejad/gps-tracking/actions/workflows/ci.yml/badge.svg)

This package provides GPS tracking functionality with a gRPC and RESTful API. It is written in TypeScript.
![Architect](https://user-images.githubusercontent.com/4404500/221377629-e570ac49-7bf7-40d8-aa98-7270cf305b13.png)

## Installation

To install this package, use the following command:


```bash
npm install
```

## Container usage
You can start the container using the command below:

    docker-compose up

This package uses a Docker image to build and run. The database attached to the container will be seeded with a default device record.

## Usage details

This package includes several scripts that can be run with 'npm run **command**'. The command below will start the REST and gRPC servers.

    npm run serve

Details of other commands:

**start**: Starts the application using ts-node to run the TypeScript code.

**start:grpc**: Starts the gRPC server.

**start:rest**: Starts the RESTful API server.

**serve**: Starts both the gRPC and RESTful API servers simultaneously.

**test**: Runs Jest test suite.

**lint**: Runs the Google TypeScript Style linter.

**clean**: Deletes all compiled files.

**compile**: Compiles TypeScript to JavaScript.

**fix**: Runs the Google TypeScript Style fixer.

**prepare**: Runs the compile script before publishing the package.

**pretest**: Runs the compile script before running tests.

**posttest**: Runs the lint script after running tests.

**gen:proto**: Generates protocol buffer files from .proto files.


This package includes the following dependencies:

**@grpc/grpc-js**: gRPC library for Node.js.

**@grpc/proto-loader**: Loads protocol buffer files dynamically.

**dotenv**: Loads environment variables from a .env file.

**express**: Web application framework for Node.js.

**grpc-tools**: Provides tools for working with protocol buffers and gRPC.

**pg**: PostgreSQL client for Node.js.

**typeorm**: Object-relational mapping library for TypeScript.

**winston**: Logging library for Node.js.

## Rest Interface

After executing the REST interface using 'npm run serve', you can create a device using the curl command below or a POST request in Postman. This endpoint is not protected by a token.

    curl --location --request POST 'http://localhost:9090/api/device' \
    --header 'Content-Type: application/json' \
    --data-raw '{
    "name": "device",
    "token": "token"
    }'

## Authorization
The 'gps-log' endpoint is protected with a token generated by the device entity, and it will only approve requests if the header is provided. For example:

    curl --location --request POST 'http://localhost:9090/api/gps-logs' \
    --header 'authorization: token' \
    --header 'Content-Type: application/json' \
    --data-raw '{
        "device_id": "fe914c68-c146-4b07-b5a0-3504763893df",
        "latitude": "20",
        "longitude": "14"
    }'

The default device credentials can be found in:

    src/migrations/01_seed_db.sql

## Testing

This package includes a Jest test suite. To run the test suite, use the following command:

    npm test

## Project Structure

    'src/config': database and URL configurations
    'src/controllers': device and log methods for handling HTTP requests
    'src/entities': database entities
    'src/grpc': gRPC server and resolver
    'src/middleware': auth middleware
    'src/migrations': migration and create table scripts for the Docker image
    'src/proto': proto buffer generated files and schema
    'src/routes': Express.js routes
    'src/services': database services
    'src/utils': utilities for logger and service load for gRPC
    'tools': proto file generator

## Contributing

Contributions to this package are welcome. Please fork this repository and submit a pull request with your changes.

## License

This package is licensed under the ISC license. See the LICENSE file for details.
